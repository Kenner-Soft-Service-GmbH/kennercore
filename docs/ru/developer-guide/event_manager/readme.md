# Event Manager #
При помощи Event Manager предоствляется возможность объявлять событие и сшушать это событие слушателем или слушателями в модулях.
### Как использовать? ###
```
$this->getContainer()->get('eventManager')->triggered($target, $action, $data); 
```
* $target - Условное название слушателя. То есть если $target='Foo', то будут активны слушатели в модулях которые размещены в `application/Espo/Modules/{MODULE_NAME}/Listeners/Foo.php`
* $action - метод который будет вызван в слушателе
* $data - данные которые будут переданы на слушатель
* метод EventManager::triggered() - всегда возврщает массив $data обратно, но массив $data может быть изменен слушателями.

## Пример: ##
```
$this->getContainer()->get('eventManager')->triggered('Foo', 'afterUpdate', ['name' => 'test']);
```
Для этого примера будут активны все слушатели Foo и в этих слушателях будет вызван метод afterUpdate. При этом на метод будет передан массив данных `['name' => 'test']`

## Спецификация: ##
* $data - массив
* Загрузка слушателей происходит в порядке загрузки модулей. При этом разные модули могут слушать одно и то же событие.
* В слушателе присутствует Container, на при условии если он унаследован от `Espo\Modules\TreoCore\Listeners\AbstractListener`.
* Слушатель может возвращать только модифицированный массив $data и далее следующим слушателям будет передан массив $data модифицированный предыдущим.

## Как "слушать" все события сущности? : ##
Если есть необходимость слушать все события сущности нужно в вашем слушателе создать метод ```common```. Пример:
```
   /**
     * Common listening of all actions
     *
     * @param string $action
     * @param array  $data
     *
     * @return array
     */
    public function common(string $action, array $data): array
    {
        return $data;
    }
```
* $action - событие которое вызывалось
* $data - данные которые передавались на событие

Важно понимать, что ```common``` будет вызван только в том случае, если нету конткретного события. То есть наличие в слушетеле события, исключает вызов ```common```.